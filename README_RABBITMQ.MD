# Rabbit MQ

It's used as a message broker to send messages between microservices.

## Is there anything in the queue?

```bash
rabbitmqctl list_queues --vhost infinitum_vhost
```

How do I delete a queue?
```bash
rabbitmqctl delete_queue webhits_queue --vhost infinitum_vhost
```

How do I look at some of the records? Well, that's not easy. You have to use the `rabbitmqadmin` command line tool.
Which is hidden away in the rabbitmq server directory. You can find it here:

```bash
python /usr/lib/rabbitmq/lib/rabbitmq_server-3.13.7/plugins/rabbitmq_management-3.13.7/priv/www/cli/rabbitmqadmin \
  get queue=webhits_queue \
  ackmode=ack_requeue_true \
  count=10 \
  --vhost=infinitum_vhost \
  --username=infinitum_admin --password=mypassword
```

Output:

| impressions_queue |          | 60245         | {"timestamp": "2025-05-11T00:00:18+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/impression", "query_string": "c=281&b=229&r=319&v=1863598048", "status": "200", "user_agent": "BrightcoveExoPlayer/10.0.2 (Linux; Android 11; Sky Box Build/RTT4.210521.001) tv Media3Lib/1.4.1", "referer": "", "client_ip": "203.211.109.44,10.242.123.222, 13.54.212.99", "host": "10.0.0.50", "line_num": 2, "query": {"client": "281", "booking": "229", "creative": "319"}}                                                                              | 468           | string           | False       |
| impressions_queue |          | 60244         | {"timestamp": "2025-05-11T00:00:20+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/viewer", "query_string": "client=307&campaign=313&creative=402&cb=", "status": "200", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36", "referer": "https://www.sbs.com.au/", "client_ip": "49.192.189.222", "host": "10.0.0.50", "line_num": 4, "query": {"client": "307", "booking": "313", "creative": "402"}}                                                         | 489           | string           | False       |
| impressions_queue |          | 60243         | {"timestamp": "2025-05-11T00:00:23+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/viewer", "query_string": "client=307&campaign=312&creative=402&cb=", "status": "200", "user_agent": "Dalvik/2.1.0 (Linux; U; Android 11; Smart TV Pro Build/RP1A.200622.001)", "referer": "-", "client_ip": "49.177.3.234, 35.241.31.95, 34.171.201.36", "host": "10.0.0.50", "line_num": 5, "query": {"client": "307", "booking": "312", "creative": "402"}}                                                                                                  | 448           | string           | False       |
| impressions_queue |          | 60242         | {"timestamp": "2025-05-11T00:00:30+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/impression", "query_string": "c=286&b=261&r=375&v=1992635431", "status": "200", "user_agent": "dashplayer souphttp 1.0", "referer": "", "client_ip": "203.211.78.54,10.242.125.233, 13.236.203.188", "host": "10.0.0.50", "line_num": 10, "query": {"client": "286", "booking": "261", "creative": "375"}}                                                                                                                                                     | 397           | string           | False       |
| impressions_queue |          | 60241         | {"timestamp": "2025-05-11T00:00:33+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/viewer", "query_string": "client=307&campaign=312&creative=400&cb=", "status": "200", "user_agent": "Mozilla/5.0 (SMART-TV; LINUX; Tizen 6.5) AppleWebKit/537.36 (KHTML, like Gecko) 85.0.4183.93/6.5 TV Safari/537.36", "referer": "-", "client_ip": "122.107.198.248, 23.62.8.183, 23.48.96.7, 23.46.180.98, 23.197.206.4, 103.75.202.253", "host": "10.0.0.50", "line_num": 11, "query": {"client": "307", "booking": "312", "creative": "400"}}            | 534           | string           | False       |
| impressions_queue |          | 60240         | {"timestamp": "2025-05-11T00:00:35+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/viewer", "query_string": "client=307&campaign=312&creative=402&cb=", "status": "200", "user_agent": "Mozilla/5.0 (SMART-TV; Linux; Tizen 6.5) AppleWebKit/538.1 (KHTML, like Gecko) Version/6.5 TV Safari/538.1 STvPlus/693ee855fa5bc33da357f811b7218a28", "referer": "-", "client_ip": "116.91.217.10, 35.243.136.46", "host": "10.0.0.50", "line_num": 13, "query": {"client": "307", "booking": "312", "creative": "402"}}                                  | 512           | string           | False       |
| impressions_queue |          | 60239         | {"timestamp": "2025-05-11T00:00:40+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/impression", "query_string": "c=105&b=317&r=409&v=", "status": "200", "user_agent": "Mozilla/5.0 (X11; Linux armv7l) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.225 Safari/537.36 CrKey/1.56.500000", "referer": "-", "client_ip": "121.74.111.11, 130.176.150.131, 54.66.198.255", "host": "10.0.0.50", "line_num": 16, "query": {"client": "105", "booking": "317", "creative": "409"}}                                                         | 489           | string           | False       |
| impressions_queue |          | 60238         | {"timestamp": "2025-05-11T00:00:43+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/impression", "query_string": "c=287&b=296&r=358&v=", "status": "200", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; Xbox; Xbox One; MSAppHost/3.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36 Edge/18.26100", "referer": "https://xbox.tvnz.io/", "client_ip": "101.53.218.34,10.242.127.106, 13.236.203.188", "host": "10.0.0.50", "line_num": 17, "query": {"client": "287", "booking": "296", "creative": "358"}} | 545           | string           | False       |
| impressions_queue |          | 60237         | {"timestamp": "2025-05-11T00:00:43+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/impression", "query_string": "c=281&b=229&r=374&v=41095350", "status": "200", "user_agent": "AppleCoreMedia/1.0.0.22L261 (Apple TV; U; CPU OS 18_4_1 like Mac OS X; en_us)", "referer": "", "client_ip": "161.29.124.193,10.242.122.163, 13.54.212.99", "host": "10.0.0.50", "line_num": 18, "query": {"client": "281", "booking": "229", "creative": "374"}}                                                                                                  | 448           | string           | False       |
| impressions_queue |          | 60236         | {"timestamp": "2025-05-11T00:01:05+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/impression", "query_string": "c=286&b=330&r=420&v=781069009", "status": "200", "user_agent": "BrightcoveExoPlayer/10.0.2 (Linux; Android 11; Sky Box Build/RTT4.210521.001) tv Media3Lib/1.4.1", "referer": "", "client_ip": "60.234.176.195,10.242.119.177, 3.104.170.241", "host": "10.0.0.50", "line_num": 29, "query": {"client": "286", "booking": "330", "creative": "420"}}                                                                             | 469           | string           | False       |
+-------------------+----------+---------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+------------------+-------------+

| webhits_queue |          | 191588        | {"timestamp": "2025-05-11T00:00:25+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/client", "query_string": "client=105&site=118", "status": "200", "user_agent": "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Mobile Safari/537.36", "referer": "https://www.fiji.travel/", "client_ip": "157.51.15.138", "host": "10.0.0.50", "line_num": 7, "query": {"client": "105", "site": "118"}}                                                                                            | 440           | string           | True        |
| webhits_queue |          | 191587        | {"timestamp": "2025-05-11T00:00:29+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/client", "query_string": "client=105&site=118", "status": "200", "user_agent": "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Mobile Safari/537.36", "referer": "https://www.fiji.travel/", "client_ip": "152.59.19.76", "host": "10.0.0.50", "line_num": 8, "query": {"client": "105", "site": "118"}}                                                                                             | 439           | string           | True        |
| webhits_queue |          | 191586        | {"timestamp": "2025-05-11T00:00:37+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/client", "query_string": "client=105&site=118", "status": "200", "user_agent": "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Mobile Safari/537.36", "referer": "https://www.fiji.travel/", "client_ip": "152.58.190.231", "host": "10.0.0.50", "line_num": 14, "query": {"client": "105", "site": "118"}}                                                                                          | 442           | string           | True        |
| webhits_queue |          | 191585        | {"timestamp": "2025-05-11T00:00:48+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/client", "query_string": "client=105&site=118", "status": "200", "user_agent": "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Mobile Safari/537.36", "referer": "https://www.fiji.travel/", "client_ip": "152.59.174.214", "host": "10.0.0.50", "line_num": 20, "query": {"client": "105", "site": "118"}}                                                                                          | 442           | string           | True        |
| webhits_queue |          | 191584        | {"timestamp": "2025-05-11T00:00:50+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/client", "query_string": "client=105&site=118", "status": "200", "user_agent": "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Mobile Safari/537.36", "referer": "https://www.fiji.travel/", "client_ip": "120.60.228.75", "host": "10.0.0.50", "line_num": 22, "query": {"client": "105", "site": "118"}}                                                                                           | 441           | string           | True        |
| webhits_queue |          | 191583        | {"timestamp": "2025-05-11T00:00:53+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/client", "query_string": "client=105&site=118", "status": "200", "user_agent": "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Mobile Safari/537.36", "referer": "https://www.fiji.travel/", "client_ip": "106.221.77.52", "host": "10.0.0.50", "line_num": 23, "query": {"client": "105", "site": "118"}}                                                                                           | 441           | string           | True        |
| webhits_queue |          | 191582        | {"timestamp": "2025-05-11T00:00:57+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/client", "query_string": "client=105&site=119", "status": "200", "user_agent": "python-requests/2.31.0", "referer": "-", "client_ip": "130.44.215.89", "host": "10.0.0.50", "line_num": 25, "query": {"client": "105", "site": "119"}}                                                                                                                                                                                                           | 329           | string           | True        |
| webhits_queue |          | 191581        | {"timestamp": "2025-05-11T00:01:01+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/client", "query_string": "client=105&site=118", "status": "200", "user_agent": "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Mobile Safari/537.36", "referer": "https://www.fiji.travel/", "client_ip": "49.36.24.213", "host": "10.0.0.50", "line_num": 27, "query": {"client": "105", "site": "118"}}                                                                                            | 440           | string           | True        |
| webhits_queue |          | 191580        | {"timestamp": "2025-05-11T00:01:14+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/client", "query_string": "client=105&site=118", "status": "200", "user_agent": "Mozilla/5.0 (Linux; Android 14; SM-S721W Build/UP1A.231005.007; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/136.0.7103.84 Mobile Safari/537.36 [FB_IAB/FB4A;FBAV/512.0.0.64.75;IABMV/1;]", "referer": "https://www.fiji.travel/", "client_ip": "74.15.213.99", "host": "10.0.0.50", "line_num": 34, "query": {"client": "105", "site": "118"}} | 531           | string           | True        |
| webhits_queue |          | 191579        | {"timestamp": "2025-05-11T00:01:16+12:00", "edge_ip": "192.168.255.80", "method": "GET", "path": "/client", "query_string": "client=105&site=118", "status": "200", "user_agent": "Mozilla/5.0 (Linux; U; Android 14; en-gb; MT2111 Build/UKQ1.230924.001) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.88 Mobile Safari/537.36 HeyTapBrowser/45.12.1.9", "referer": "https://www.fiji.travel/", "client_ip": "106.219.71.66", "host": "10.0.0.50", "line_num": 36, "query": {"client": "105", "site": "118"}}                           | 505           | string           | True        |
+---------------+----------+---------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+------------------+-------------+
