redis raw log entries:

 1) "{\"host\": \"10.0.0.153\", \"line_num\": 43798, \"raw\": \"2025-05-11T12:54:05+12:00\\t192.168.255.42\\tGET\\t/response?c=281&s=311\\tc=281&s=311\\t200\\tMozilla/5.0 (Linux; Android 5.1.1; SM-T365Y) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.74 Safari/537.36\\thttps://www.avis.co.nz/\\t60.234.149.177\"}"
 2) "{\"host\": \"10.0.0.153\", \"line_num\": 43797, \"raw\": \"2025-05-11T12:54:04+12:00\\t192.168.255.42\\tGET\\t/health_check\\t-\\t200\\t-\\t-\\t-\"}"
 3) "{\"host\": \"10.0.0.153\", \"line_num\": 43796, \"raw\": \"2025-05-11T12:54:03+12:00\\t192.168.255.42\\tGET\\t/client?client=261&site=256&gtmcb=664263577\\tclient=261&site=256&gtmcb=664263577\\t200\\tMozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Mobile Safari/537.36\\thttps://www.firsttable.co.nz/\\t125.238.202.79\"}"
 4) "{\"host\": \"10.0.0.153\", \"line_num\": 43795, \"raw\": \"2025-05-11T12:54:02+12:00\\t192.168.255.42\\tGET\\t/client?client=262&site=257%27%20style=%27width:%201px;%20height:%201px;%20border:%20none;%20position:%20absolute;%20top:%20-9999px;%20left:%20-9999px;&gtmcb=309899432\\tclient=262&site=257%27%20style=%27width:%201px;%20height:%201px;%20border:%20none;%20position:%20absolute;%20top:%20-9999px;%20left:%20-9999px;&gtmcb=309899432\\t200\\tMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36\\thttps://www.bigsave.co.nz/\\t103.63.95.208\"}"
 5) "{\"host\": \"10.0.0.153\", \"line_num\": 43794, \"raw\": \"2025-05-11T12:54:02+12:00\\t192.168.255.42\\tGET\\t/client?client=261&site=256&gtmcb=738384052\\tclient=261&site=256&gtmcb=738384052\\t200\\tMozilla/5.0 (iPhone; CPU iPhone OS 18_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.4 Mobile/15E148 Safari/604.1\\thttps://www.firsttable.co.nz/\\t115.189.131.234\"}"
 6) "{\"host\": \"10.0.0.153\", \"line_num\": 43793, \"raw\": \"2025-05-11T12:54:02+12:00\\t192.168.255.42\\tGET\\t/response?c=279&s=308%27%20style=%27width:%201px;%20height:%201px;%20border:%20none;%20position:%20absolute;%20top:%20-9999px;%20left:%20-9999px;%27%3E&gtmcb=256260131\\tc=279&s=308%27%20style=%27width:%201px;%20height:%201px;%20border:%20none;%20position:%20absolute;%20top:%20-9999px;%20left:%20-9999px;%27%3E&gtmcb=256260131\\t200\\tMozilla/5.0 (iPhone; CPU iPhone OS 17_6_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.6 Mobile/15E148 Safari/604.1\\thttps://www.window-treatments.co.nz/\\t203.211.105.206\"}"
 7) "{\"host\": \"10.0.0.153\", \"line_num\": 43792, \"raw\": \"2025-05-11T12:54:01+12:00\\t192.168.255.42\\tGET\\t/response?c=287&s=348\\tc=287&s=348\\t200\\tMozilla/5.0 (Linux; Android 14; SM-A245F Build/UP1A.231005.007; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/135.0.7049.113 Mobile Safari/537.36\\thttps://www.financenow.co.nz/\\t125.239.225.73\"}"
 8) "{\"host\": \"10.0.0.153\", \"line_num\": 43791, \"raw\": \"2025-05-11T12:54:00+12:00\\t192.168.255.42\\tGET\\t/client?client=261&site=256&gtmcb=438139663\\tclient=261&site=256&gtmcb=438139663\\t200\\tMozilla/5.0 (iPhone; CPU iPhone OS 18_3_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.3.1 Mobile/15E148 Safari/604.1\\thttps://www.firsttable.co.nz/\\t103.187.6.41\"}"
 9) "{\"host\": \"10.0.0.153\", \"line_num\": 43790, \"raw\": \"2025-05-11T12:53:59+12:00\\t192.168.255.42\\tGET\\t/response?c=310&s=401%27%20style=%27width:%201px;%20height:%201px;%20border:%20none;%20position:%20absolute;%20top:%20-9999px;%20left:%20-9999px;&gtmcb=1808435906\\tc=310&s=401%27%20style=%27width:%201px;%20height:%201px;%20border:%20none;%20position:%20absolute;%20top:%20-9999px;%20left:%20-9999px;&gtmcb=1808435906\\t200\\tMozilla/5.0 (iPhone; CPU iPhone OS 18_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/22E252 Instagram 379.0.0.26.81 (iPhone16,1; iOS 18_4_1; en_GB; en-GB; scale=3.00; 1179x2556; 729569027; IABMV/1)\\thttps://wondershop.sg/\\t128.106.240.2\"}"
10) "{\"host\": \"10.0.0.153\", \"line_num\": 43789, \"raw\": \"2025-05-11T12:53:59+12:00\\t192.168.255.42\\tGET\\t/health_check\\t-\\t200\\t-\\t-\\t-\"}"

Reset tables:


drop table edge_data.impressions;
create table edge_data.impressions
(
    id          bigint auto_increment
        primary key,
    timestmp    datetime default current_timestamp() not null,
    client_id   int                                  not null,
    booking_id  int                                  not null,
    creative_id int                                  not null,
    ipaddress inet6 not null,
    useragent   varchar(500)                         null
)
    AUTO_INCREMENT =40088978
    charset = utf8mb4;

create index idx_impressions_client_booking_creative_timestmp
    on edge_data.impressions (client_id, booking_id, creative_id, timestmp);

create index idx_impressions_ip_client_channel_timestmp
    on edge_data.impressions (client_id, timestmp);

create index idx_impressions_ipaddress
    on edge_data.impressions (ipaddress);

create index impressions_ipaddress_booking_id_timestmp_index
    on edge_data.impressions (ipaddress, booking_id, timestmp);

drop table edge_data.webhits;
create table edge_data.webhits
(
    id            bigint auto_increment
        primary key,
    timestmp      datetime default current_timestamp() not null,
    client_id     int                                  null,
    site_id       int                                  null,
    ipaddress inet6 not null,
    impression_id bigint                               null
)
    AUTO_INCREMENT = 1053230
    charset = utf8mb4;

create index webhits_impression_id_index
    on edge_data.webhits (impression_id);

create index webhits_impression_id_site_id_index
    on edge_data.webhits (impression_id, site_id);

create index webhits_ipaddress_timestmp_impression_id_index
    on edge_data.webhits (ipaddress, timestmp, impression_id);

